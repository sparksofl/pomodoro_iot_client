'use strict';











jest.
unmock('NavigationStackReducer').
unmock('NavigationStateUtils');

jest.setMock('React',{Component:function Component(){},PropTypes:{}});




describe('NavigationStackReducer',function(){

it('provides default/initial state',function(){
var initialState={
children:[
{key:'a'}],

index:0,
key:'myStack'};

var reducer=require('NavigationStackReducer')({
getPushedReducerForAction:function getPushedReducerForAction(action){return null;},
getReducerForState:function getReducerForState(state){return function(){return state;};},
initialState:initialState});

var dummyAction={type:'dummyAction'};
expect(reducer(null,dummyAction)).toBe(initialState);});


it('handles basic reducer pushing',function(){
var reducer=require('NavigationStackReducer')({
getPushedReducerForAction:function getPushedReducerForAction(action){
if(action.type==='TestPushAction'){
return function(state){return state||{key:action.testValue};};}

return null;},

getReducerForState:function getReducerForState(state){return function(){return state;};},
initialState:{
children:[
{key:'first'}],

index:0,
key:'myStack'}});


var state1=reducer(null,{type:'default'});
expect(state1.children.length).toBe(1);
expect(state1.children[0].key).toBe('first');
expect(state1.index).toBe(0);

var action={type:'TestPushAction',testValue:'second'};
var state2=reducer(state1,action);
expect(state2.children.length).toBe(2);
expect(state2.children[0].key).toBe('first');
expect(state2.children[1].key).toBe('second');
expect(state2.index).toBe(1);});


it('handles BackAction',function(){
var reducer=require('NavigationStackReducer')({
getPushedReducerForAction:function getPushedReducerForAction(action){
if(action.type==='TestPushAction'){
return function(state){return state||{key:action.testValue};};}

return null;},

getReducerForState:function getReducerForState(state){return function(){return state;};},
initialState:{
children:[
{key:'a'},
{key:'b'}],

index:1,
key:'myStack'}});



var state1=reducer(null,{type:'MyDefaultAction'});
expect(state1.children[0].key).toBe('a');
expect(state1.children[1].key).toBe('b');
expect(state1.children.length).toBe(2);
expect(state1.index).toBe(1);
expect(state1.key).toBe('myStack');

var state2=reducer(state1,require('NavigationRootContainer').getBackAction());
expect(state2.children[0].key).toBe('a');
expect(state2.children.length).toBe(1);
expect(state2.index).toBe(0);

var state3=reducer(state2,require('NavigationRootContainer').getBackAction());
expect(state3).toBe(state2);});


it('allows inner reducers to handle back actions',function(){
var subReducer=require('NavigationStackReducer')({
getPushedReducerForAction:function getPushedReducerForAction(){},
initialState:{
children:[
{key:'first'},
{key:'second'}],

index:1,
key:'myInnerStack'}});



var reducer=require('NavigationStackReducer')({
getPushedReducerForAction:function getPushedReducerForAction(action){
if(action.type==='TestPushAction'){
return subReducer;}


return null;},

getReducerForState:function getReducerForState(state){
if(state.key==='myInnerStack'){
return subReducer;}

return function(){return state;};},

initialState:{
children:[
{key:'a'}],

index:0,
key:'myStack'}});



var state1=reducer(null,{type:'MyDefaultAction'});
var state2=reducer(state1,{type:'TestPushAction'});
expect(state2.children.length).toBe(2);
expect(state2.children[0].key).toBe('a');
expect(state2.children[1].key).toBe('myInnerStack');
expect(state2.children[1].children.length).toBe(2);
expect(state2.children[1].children[0].key).toBe('first');
expect(state2.children[1].children[1].key).toBe('second');

var state3=reducer(state2,require('NavigationRootContainer').getBackAction());
expect(state3.children.length).toBe(2);
expect(state3.children[0].key).toBe('a');
expect(state3.children[1].key).toBe('myInnerStack');
expect(state3.children[1].children.length).toBe(1);
expect(state3.children[1].children[0].key).toBe('first');});});